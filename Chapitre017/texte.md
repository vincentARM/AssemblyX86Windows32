# Chapitre 17 lecture et écriture de fichiers.

Ici aussi, nous allons utiliser les fonctions de l’Api windows pour lire et écrire dans un fichier. Mais nous avons déjà rencontré les fonctions principales puisque ce sont les mêmes que celles utilisés pour afficher dans la console ou lire des données au clavier. Seul le handle est différent. <br>
Dans le programme lectureEcritureFic.asm dont l’éxécution est lancée par ./lectureEcritureFic test1.txt ecrit1.txt nous commençons par découper la ligne de commande comme nous l’avons vu au chapitre précédent avec les 2 fonctions de l’Api windows : GetCommandLineW et CommandLineToArgvW. Puis nous convertissons le nom du fichier d’entrée avec la fonction WideCharToMultiByte. <br>
Ce nom va nous servir pour ouvrir le fichier en lecture avec la fonction CreateFileA et s’il n’y a pas d’erreur, nous récupérons la référence (handle) du fichier. Cette référence va nous servir à lire les données du fichier et les stocker dans un buffer que nous affichons. Nous retrouvons bien les lignes du fichier séparées par les codes 0x0d et 0x0A de fin de ligne. <br>
Comme nous avons initialisé le buffer avec des étoiles, nous pouvons constater que rien n’indique la fin du fichier. Il faudra donc se servir du nombre d’octets lus de la zone iNbByteLu pour arrêter les traitements qui se serviront de ces données. <br>
Nous fermons le fichier lu en utilisant la fonction CloseHandle.<br> Puis nous passons à l’écriture dans un fichier. Nous récupérons le nom du fichier dans le 3ième paramètre de la ligne de commande et après conversion, nous créons le fichier en écriture avec la méme fonction que pour la lecture CreateFileA mais pas avec les mêmes paramètres.<br>
Puis nous écrivons les données contenues dans le buffer de lecture en nous servant du compteur d’octets lus avec la fonction WriteFile. Nous effectuons un contrôle que le nombre d’octets écrits correspondent au nombre d’octets lus puis nous fermons le fichier avec la fonction CloseHandle.<br>
Tout est Ok et vous pouvre remarquez que le fichier de sortie est identique au fichier lu !!!<br>
